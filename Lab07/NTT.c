#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdint.h>

#define Q   12289   // 14'b11000000000001
#define Q0I 12287   // 14'b10111111111111

// max = 12276 = 14'b10111111110100
uint32_t GMb[128] = 
{
    4091, 
    7888, 
    11060, 
    11208, 
    6960, 
    4342, 
    6275, 
    9759, 
    1591, 
    6399, 
    9477, 
    5266, 
    586, 
    5825, 
    7538, 
    9710, 
    1134, 
    6407, 
    1711, 
    965, 
    7099, 
    7674, 
    3743, 
    6442, 
    10414, 
    8100, 
    1885, 
    1688, 
    1364, 
    10329, 
    10164, 
    9180, 
    12210, 
    6240, 
    997, 
    117, 
    4783, 
    4407, 
    1549, 
    7072, 
    2829, 
    6458, 
    4431, 
    8877, 
    7144, 
    2564, 
    5664, 
    4042, 
    12189, 
    432, 
    10751, 
    1237, 
    7610, 
    1534, 
    3983, 
    7863, 
    2181, 
    6308, 
    8720, 
    6570, 
    4843, 
    1690, 
    14, 
    3872, 
    5569, 
    9368, 
    12163, 
    2019, 
    7543, 
    2315, 
    4673, 
    7340, 
    1553, 
    1156, 
    8401, 
    11389, 
    1020, 
    2967, 
    10772, 
    7045, 
    3316, 
    11236, 
    5285, 
    11578, 
    10637, 
    10086, 
    9493, 
    6180, 
    9277, 
    6130, 
    3323, 
    883, 
    10469, 
    489, 
    1502, 
    2851, 
    11061, 
    9729, 
    2742, 
    12241, 
    4970, 
    10481, 
    10078, 
    1195, 
    730, 
    1762, 
    3854, 
    2030, 
    5892, 
    10922, 
    9020, 
    5274, 
    9179, 
    3604, 
    3782, 
    10206, 
    3180, 
    3467, 
    4668, 
    2446, 
    7613, 
    9386, 
    834, 
    7703, 
    6836, 
    3403, 
    5351, 
    12276
};

uint32_t modq_mul(uint32_t a, uint32_t b) {
    // int R = 0x1 << 16;
    uint32_t x = a * b;
    uint32_t y = (x * Q0I) & 0xFFFF; // (...) % R
    uint32_t z = (x + y * Q) >> 16;  // (...) / R
    return (z >= Q) ? (z - Q) : z;
}

void NTT(uint32_t *array) {     // 4-bit
    // int t = 128;
    for (int m = 1, ht = 64; m < 128; m <<= 1, ht >>= 1) {
        for (int i = 0, j_1 = 0; i < m; i++, j_1 += (ht << 1)) {
            uint32_t s = GMb[m+i];  // 14-bit
            printf("GMb[%d]\n", m+i);
            // int j_2 = j_1 + ht;
            for (int j = j_1; j < j_1 + ht; j++) {
                uint32_t u = array[j];                      // 4-bit
                uint32_t v = modq_mul(array[j + ht], s);    // 14-bit, 12288, 14'b11000000000000
                array[j]      = (u + v) % Q;
                // array[j + ht] = (u - v) % Q;
                array[j + ht] = (u >= v) ? (u - v) : ((u + Q) - v); // (u - v) % Q;
                printf("%d, %d\n", j, j + ht);
            }
            // printf("\n");
        }
        printf("\n");
    }
}

int main() {
    uint32_t ntt_array[128];
    for (int i = 0; i < 128; i++) {
        // ntt_array[i] = i;
        ntt_array[i] = 1;
    }
    NTT(ntt_array);
    // for (int i = 0; i < 128; i++) {
    //     printf("%d, ", ntt_array[i]);
    // }
    return 0;
}
